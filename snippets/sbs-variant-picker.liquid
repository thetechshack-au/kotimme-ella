{%- doc -%}
  Renders a default variant picker, used to display the variant picker in the variants block.

  @param {object} product_resource - The product object.
  @param {object} [block] - The block object
{%- enddoc -%}

{%- liquid
    assign bl_stts = block.settings
    assign custom_fields = product.metafields.custom.combined_products_listing
-%}

{% unless product_resource.has_only_default_variant %}
  {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
  {{ 'component-swatch.css' | asset_url | stylesheet_tag }}
  
  <variant-selects
    id="variant-selects-{{ block.id }}"
    class="variant-selects spacing-style variant-selects--{{ bl_stts.alignment }}"
    style="{% render 'spacing-style', settings: bl_stts %}"
    data-section="{{ block.id }}"
    data-section-id="{{ block.id }}"
    data-product-id="{{ product_resource.id }}"
    data-block-id="{{ block.id }}"
    data-product-url="{{ product_resource.url }}"
    data-context="main"
    ref="mainVariantSelects"
    {% if product.id == product_resource.id %}
      data-template-product-match="true"
    {% endif %}
    {{ block.shopify_attributes }}
    {% if request.visual_preview_mode %}
      data-shopify-visual-preview
    {% endif %}
    style="
      --detail-variant-bg: {{ detail_variant_bg }};
    "
  >
    {%- for product_option in product_resource.options_with_values -%}
      {%- liquid
        assign variant_style = 'pills'
        assign product_swatch_option = settings.swatch | downcase
        assign swatch_type = settings.swatch_type
        assign option_name = product_option.name | downcase
        assign is_color = true

        assign variant_style = 'swatch'
      -%}
        <fieldset  class="js product-form__input variant-option variant-option--buttons{% if is_color %} product-form__input--swatch variant-option--swatches{% else %} product-form__input--pill variant-option--pill{% endif %}" data-option-index="{{ forloop.index0 }}" data-step="{{ forloop.index0 }}">
          {% if product_swatch_option contains option_name %}
          <div class="has-perk color-comparison w-full flex justify-between items-center">
          {% endif %}
          <legend class="form__label">
            {{ product_option.name | escape | prepend: 'Choose ' }}:
            <span data-selected-value>
              {{- product_option.selected_value -}}
            </span>
          </legend>
          {% if product_swatch_option contains option_name %}
          </div>
          {% endif %}
          {% render 'product-variant-options',
            option: product_option,
            block: block,
            variant_style: variant_style,
            swatch_type: swatch_type,
            is_color: is_color,
            index: forloop.index0,
            sbs_variant_picker: true
          %}
        </fieldset>
    {%- endfor -%}

    {% if show_customization_option and require_item != blank %}
      <div class="product-form__input product-step__input" data-step="{{ forloop_index }}">
        <div class="form__label">
          {{ require_item }}:
        </div>
        <textarea id="{{ require_item | handleize | append: '-' | append: product_resource.id }}" class="text-area form-input not-change" rows="6" name="properties[{{ require_item }}]"></textarea>
      </div>
    {% endif %}

    <script type="application/json" data-selected-variant>
      {{ product_resource.selected_or_first_available_variant | json }}
    </script>
    <script data-all-variants>
      {{ product.variants | json }}
    </script>
  </variant-selects>
{% endunless %}

<script>
  {% assign selected_variant = product.selected_or_first_available_variant %}
  window.product_inventory_policy_array_{{ product.id }} = {
    '{{ selected_variant.id }}': '{{ selected_variant.inventory_policy }}',
  };
</script>
