{%- doc -%}
  Renders a product media component.

  @param {object} media - The product media object.
  @param {boolean} [preview_image_only] - Renders only the preview image without controls.
  @param {string} [widths] - Image widths for responsive images.
  @param {string} [sizes] - Image sizes for responsive images.
  @param {string} [loading] - The loading attribute for the image.
  @param {object} [block] - The block object.
  @param {string} [class] - The class for the image.
  @param {object} [selected_product] - The currently selected product.
  @param {boolean} [first_3d_model] - Indicates if this is the first 3D model.
  @param {boolean} [is_main_product_media] - Indicates if this is the main product image.
  @param {object} [bl_stts] - The block settings.

  @example
  {% render 'product-media', media: media, preview_image_only: false, loading: 'lazy' %}
{%- enddoc -%}

{% liquid
  assign widths = widths | default: '240, 352, 832, 1200, 1600, 1920, 2560, 3840'
%}

<div
  class="product-media{% if bl_stts.zoom and bl_stts.zoom_type == 'inline'%} product__modal-opener{% endif %}"
  {%- if media.media_type == 'image' -%}
    style="--ratio: {{ media.aspect_ratio }}"
  {%- endif -%}
  data-media-id="{{ media.id }}"
>
  {% liquid
    assign high_res_url = media.preview_image | image_url: width: 3840
    assign fetch_priority = 'auto'
    if is_main_product_media
      assign fetch_priority = 'high'
    endif
    if class
      assign image_class = class
    endif
    assign product_media_image_class = image_class | append: ' product-media__image '
  %}
  {%- render 'loading-spinner' -%}
  {{
    media.preview_image
    | image_url: width: 3840
    | image_tag:
      widths: widths,
      alt: media.alt,
      sizes: sizes,
      loading: loading,
      class: product_media_image_class,
      transitionToProduct: settings.transition_to_main_product,
      data_max_resolution: high_res_url,
      fetchpriority: fetch_priority
  }}

  {% unless preview_image_only %}
    {%- case media.media_type -%}
      {% when 'model' %}
        <product-model
          class="product-model-wrapper deferred-media media media--transparent"
          data-media-id="{{ media.id }}"
        >
          <button
            id="Deferred-Poster-Modal-{{ media.id }}"
            class="button button-unstyled"
            type="button"
          >
            <span class="deferred-media__poster-icon motion-reduce">
              <span class="visually-hidden">{{ 'accessibility.play_model' | t }}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
                focusable="false"
                class="icon icon-3d-model"
                fill="none"
                viewBox="0 0 18 21"
              >
                {% render 'icon', icon: '3d-model' %}
              </svg>
            </span>
            {{
              media.preview_image
              | image_url: width: 3840
              | image_tag:
                widths: widths,
                alt: media.alt,
                sizes: sizes,
                loading: loading,
                class: 'deferred-media__poster-image'
            }}
          </button>
          <template>
            {{ media | model_viewer_tag }}
          </template>
        </product-model>
        <button
          class="button-secondary button-shopify-xr"
          type="button"
          data-shopify-xr
          data-shopify-model3d-id="{{ media.id }}"
          data-shopify-title="{{ selected_product.title | escape }}"
          data-shopify-xr-hidden
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            focusable="false"
            class="icon icon-3d-model"
            fill="none"
            viewBox="0 0 18 21"
          >
            {% render 'icon', icon: '3d-model' %}
          </svg>
          {{ 'actions.view_in_your_space' | t }}
        </button>

        {%- if first_3d_model -%}
          <script
            type="application/json"
            id="ProductModelJSON-{{ selected_product.id }}"
          >
            {{ selected_product.media | where: 'media_type', 'model' | json }}
          </script>
        {%- endif -%}
      {% when 'video', 'external_video' %}
        {%- render 'video',
          video: media,
          video_class: 'media media--transparent h-full',
          video_style: 'data-swiper-parallax="35%"',
          video_loop: block.settings.video_loop,
          video_autoplay: block.settings.video_autoplay,
          widths: widths,
          sizes: sizes,
          loading: loading,
          disable_controls: true
        -%}
    {% endcase %}
  {% endunless %}
</div>
