{% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
{%- if predictive_search.performed -%}
  {% assign first_column_results_size = predictive_search.resources.queries.size
    | plus: predictive_search.resources.collections.size
    | plus: predictive_search.resources.pages.size
    | plus: predictive_search.resources.articles.size
    | plus: predictive_search.resources.queries.size
  %}

  {% comment %} {%- render 'loading-spinner', class: 'predictive-search__loading-state no-js-hidden' -%} {% endcomment %}

  <div id="predictive-search-results" role="listbox">
    {% if settings.search_layout == 'default' %}
      {%- if first_column_results_size > 0 or predictive_search.resources.products.size > 0 -%}
        {% assign shared_results_index = 0 %}
        {% if predictive_search.resources.queries.size > 0 %}
          <h6 id="predictive-search-queries" class="predictive-search__heading body-m-font-size">
            {{- 'content.suggestions' | t -}}
          </h6>
          {%- render 'predictive-search-queries',
            queries: predictive_search.resources.queries
          -%}
        {% endif %}
        <div
          id="predictive-search-results-groups-wrapper"
          class="predictive-search__results-groups-wrapper{% unless predictive_search.resources.products.size > 0 %} predictive-search__results-groups-wrapper--no-products{% endunless %}{% unless predictive_search.resources.queries.size > 0  %} predictive-search__results-groups-wrapper--no-suggestions{% endunless %}"
        >
      {%- endif -%}
      {%- if first_column_results_size > 0 -%}
        <div class="predictive-search__result-group">
      {%- endif -%}
      {%- if predictive_search.resources.collections.size > 0 -%}
        <div class="predictive-search__collections-wrapper">
          <h6 id="predictive-search-collections" class="predictive-search__heading body-m-font-size">
            {{- 'content.collections' | t -}}
          </h6>
          <ul
            id="predictive-search-results-collections-list"
            class="predictive-search__results-list list-unstyled"
            role="group"
            aria-labelledby="predictive-search-collections"
          >
            {%- for collection in predictive_search.resources.collections -%}
              <li
                id="predictive-search-option-collection-{{ forloop.index }}"
                class="predictive-search__list-item"
                role="option"
                aria-selected="false"
              >
                <a href="{{ collection.url }}" class="predictive-search__item link link--text" tabindex="-1">
                  <div class="predictive-search__item-content predictive-search__item-content--centered">
                    <p class="predictive-search__item-heading link--hover-underline">{{ collection.title | escape }}</p>
                  </div>
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}
      {%- if predictive_search.resources.pages.size > 0 -%}
        <div class="predictive-search__pages-wrapper">
          <h6
            id="predictive-search-pages-desktop"
            class="predictive-search__heading body-m-font-size"
          >
            {{- 'content.pages' | t -}}
          </h6>
          <ul
            id="predictive-search-results-pages-list-desktop"
            class="predictive-search__results-list list-unstyled"
            role="group"
            aria-labelledby="predictive-search-pages-desktop"
          >
            {%- for page in predictive_search.resources.pages -%}
              <li
                id="predictive-search-option-page-desktop-{{ forloop.index }}"
                class="predictive-search__list-item"
                role="option"
                aria-selected="false"
              >
                <a href="{{ page.url }}" class="predictive-search__item link link--text" tabindex="-1">
                  <div class="predictive-search__item-content predictive-search__item-content--centered">
                    <p class="predictive-search__item-heading link--hover-underline">{{ page.title | escape }}</p>
                  </div>
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}
      {%- if first_column_results_size > 0 -%}
        </div>
      {%- endif -%}
      {%- if predictive_search.resources.products.size > 0
        or predictive_search.resources.articles.size > 0
        or predictive_search.resources.pages.size > 0
      -%}

        {%- liquid
          if settings.search_type == 'inline'
            assign resource_direction = 'column'
          endif
        -%}
        <div class="predictive-search__result-group">
          {%- if predictive_search.resources.products.size > 0 -%}
            {% assign products = predictive_search.resources.products %}
            {% assign products_test_id = 'products-list-results' %}
            {% assign title = 'content.products' | t %}
            {% if products.size > 0 %}
              {% render 'predictive-search-products-list',
                products_test_id: products_test_id,
                title: title,
                products: products,
                resource_direction: resource_direction
              %}
            {% else %}
              <div class="predictive-search-results__no-results">
                <p>{{ 'content.no_products_found' | t }}</p>
              </div>
            {% endif %}
          {%- endif -%}
          {%- if predictive_search.resources.pages.size > 0 -%}
            <div class="predictive-search__pages-wrapper">
              <h6
                id="predictive-search-pages-desktop"
                class="predictive-search__heading body-m-font-size"
              >
                {{- 'content.pages' | t -}}
              </h6>
              <ul
                id="predictive-search-results-pages-list-desktop"
                class="predictive-search__results-list list-unstyled"
                role="group"
                aria-labelledby="predictive-search-pages-desktop"
              >
                {%- for page in predictive_search.resources.pages -%}
                  <li
                    id="predictive-search-option-page-desktop-{{ forloop.index }}"
                    class="predictive-search__list-item"
                    role="option"
                    aria-selected="false"
                  >
                    <a href="{{ page.url }}" class="predictive-search__item link link--text" tabindex="-1">
                      <div class="predictive-search__item-content predictive-search__item-content--centered">
                        <p class="predictive-search__item-heading link--hover-underline">{{ page.title | escape }}</p>
                      </div>
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
          {%- if predictive_search.resources.articles.size > 0 -%}
            <div class="predictive-search__articles-wrapper">
              <h6
                id="predictive-search-articles-desktop"
                class="predictive-search__heading body-m-font-size"
              >
                {{- 'content.articles' | t -}}
              </h6>
              <ul
                id="predictive-search-results-articles-list-desktop"
                class="predictive-search__results-list list-unstyled"
                role="group"
                aria-labelledby="predictive-search-articles-desktop"
              >
                {%- for article in predictive_search.resources.articles -%}
                  <li
                    id="predictive-search-option-article-desktop-{{ forloop.index }}"
                    class="predictive-search__list-item"
                    role="option"
                    aria-selected="false"
                  >
                    <a href="{{ article.url }}" class="predictive-search__item link link--text" tabindex="-1">
                      <div class="predictive-search__item-content predictive-search__item-content--centered">
                        <p class="predictive-search__item-heading link--hover-underline">{{ article.title | escape }}</p>
                      </div>
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
      {%- if first_column_results_size > 0 or predictive_search.resources.products.size > 0 -%}
        </div>
      {%- endif -%}

      {%- render 'loading-spinner', class: 'predictive-search__loading-state' -%}

      <div id="predictive-search-option-search-keywords" class="predictive-search__search-for-button">
        <button
          class="predictive-search__item predictive-search__item--term link link--text h5 animate-arrow"
          tabindex="-1"
          role="option"
          aria-selected="false"
        >
          <span data-predictive-search-search-for-text>
            {{- 'content.search_for' | t: terms: predictive_search.terms -}}
          </span>
          <span class="svg-wrapper">
            {{- 'icon-arrow.svg' | inline_asset_content -}}
          </span>
        </button>
      </div>

    {% else %}
      {% render 'predictive-search-tab', predictive_search: predictive_search %}
    {% endif %}
  </div>

  <span class="hidden" data-predictive-search-live-region-count-value>
    {% liquid
      assign total_results = predictive_search.resources.products.size | plus: first_column_results_size
      if total_results == 0
        echo 'content.no_results' | t: terms: predictive_search.terms
      else
        echo 'content.results_with_count' | t: count: total_results | append: ': '
        if predictive_search.resources.queries.size > 0
          assign count = predictive_search.resources.queries.size | plus: predictive_search.resources.collections.size
          echo 'content.results_suggestions_with_count' | t: count: count | append: ', '
        endif
        if predictive_search.resources.pages.size > 0
          assign count = predictive_search.resources.pages.size | plus: predictive_search.resources.articles.size
          echo 'content.results_pages_with_count' | t: count: count | append: ', '
        endif
        if predictive_search.resources.products.size > 0
          echo 'content.results_products_with_count' | t: count: predictive_search.resources.products.size
        endif
      endif
    %}
  </span>
{%- endif -%}
