<side-drawer-opener
  class="target-block product-popup-modal__opener inline-block"
  data-side-drawer="#popup-recently-viewed"
>
  <button
    class="multi-t__button p-0 flex items-center justify-center relative cursor-pointer bor-none rounded-full"
    data-target="multitasking-recently-viewed"
    type="button"
    aria-haspopup="dialog"
    aria-label="{{ 'content.recently_viewed_products' | t }}"
    {{ block.shopify_attributes }}
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 511.1 479.39"
      class="icon icon-recently-viewed"
      aria-hidden="true"
      focusable="false"
      role="presentation"
    >
      <path fill="currentColor" d="M250.58,479.39c-8.32-1.31-16.7-2.36-25-4-58.29-11.37-105.26-40.94-141.09-88.24-6.86-9-6-18.73,1.94-24.57,7.7-5.66,17.09-3.57,23.74,5.32A197.18,197.18,0,0,0,285.56,446.7c72.16-6.1,127.32-40.21,164.81-101.93,22.25-36.62,30.95-76.91,28.1-119.78C473.08,143.56,418.19,68.58,336,42.73,264,20.1,197.59,33,138.89,80.58c-39.2,31.76-62.43,73.51-71.65,123.08a18.25,18.25,0,0,0,0,2.25c3.3-3.35,6-6.23,8.87-9,7-6.73,16.75-6.83,23.16-.32s6.29,16-.37,22.79q-19.62,19.91-39.52,39.51c-7.84,7.69-18.7,6.59-24.91-2.55Q18.49,232.88,3,209.09c-5.28-8.05-3.26-17.8,4.37-22.77,7.4-4.82,16.78-2.75,22.34,5,1.69,2.35,3.28,4.77,4.95,7.2,3.88-13.53,6.68-26.87,11.5-39.44C77.69,76.7,136.3,23.79,222.64,5.76,310-12.48,385.78,12.89,447.42,77.41c35.21,36.85,55.29,81.56,61.78,132.24.56,4.41,1.26,8.8,1.9,13.21v33.93c-.4,2.94-.85,5.87-1.2,8.81-5.35,45.62-21.73,86.8-50.45,122.74q-56,70.11-144.41,87.05c-8.78,1.66-17.68,2.68-26.53,4Z"/>
      <path fill="currentColor" d="M247.61,175.92q0-35.19,0-70.37c0-10.53,6.54-17.52,16.19-17.43,9.28.1,15.7,7.19,15.7,17.45q0,64.62-.07,129.25a8.58,8.58,0,0,0,3.86,7.83c27.65,20.75,55.29,41.54,82.66,62.66A24.82,24.82,0,0,1,374,316.64c2.14,6.68-1.19,13.35-6.94,16.69-6.18,3.6-12.43,3.38-18.23-.89-10.44-7.69-20.78-15.53-31.15-23.31-20.74-15.56-41.43-31.21-62.26-46.66a18.08,18.08,0,0,1-7.9-15.69C247.68,223.16,247.61,199.54,247.61,175.92Z"/>
    </svg>
  </button>
  <span class="target-block--tooltip">{{ 'content.recently_viewed_products' | t }}</span>
</side-drawer-opener>

<side-drawer
  class="multi-t__products drawer__container drawer fixed top-0 left-0 w-screen h-full z-9 flex no-js-hidden"
  id="popup-recently-viewed"
  data-drawer-direction="right"
>
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}

  <div id="Drawer-Overlay-Multitasking-Bar" class="drawer__overlay fixed inset-0 cursor-pointer"></div>
  <div
    class="drawer__inner-wrapper"
    data-drawer-content
    style="--drawer-max-width: var(--normal-content-width);"
  >
    <div
      class="drawer__inner{% if block.settings.inherit_color_scheme == false %} color-scheme-custom{% endif %}"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'content.recently_viewed' | t }}"
      tabindex="-1"
      {% if block.settings.inherit_color_scheme == false %}
        style="{% render 'color-scheme-style', settings: block.settings %}"
      {% endif %}
    >
      <div class="drawer__header flex justify-between items-center relative" style="--p: 1.5rem 0;">
        <h2 class="drawer__heading break m-0 h5">{{ 'content.recently_viewed' | t }}</h2>
        <side-drawer-close
          class="drawer__close block t-button bor-none rounded-full cursor-pointer"
          data-side-drawer="#popup-recently-viewed"
        >
          <button class="button--drawer focus-inset">
            <span class="visually-hidden">Close</span>
            {{- 'icon-close.svg' | inline_asset_content -}}
          </button>
        </side-drawer-close>
      </div>
      <recently-viewed-products
        class="recently-viewed-products collection cus-scrollbar"
        id="recently-viewed-drawer-{{ section.id }}"
        data-url="{{ routes.search_url }}?section_id={{ section.id }}&type=product&q="
        data-limit="{{ block.settings.products_to_show }}"
        data-id="{{ section.id }}"
        {% if request.page_type == 'product' %}
          data-product-id="{{ product.id }}"
        {% endif %}
      >
        {%- if request.page_type == 'search' and search.results_count > 0 and search.performed -%}
          <ul class="list-unstyled " role="list">
            {% assign parsed_terms = search.terms | split: ' OR ' %}
            {% assign skip_card_product_styles = false %}
            {%- for parsed_term in parsed_terms -%}
              {%- assign product_id = parsed_term | split: 'id:' | last | times: 1 -%}
              {%- for product in search.results -%}
                {%- if product.id == product_id -%}
                  <li class="product-item">
                    {% content_for 'block', type: 'card-product-flex', id: 'product-item', closest.product: product %}
                  </li>
                  {%- assign skip_card_product_styles = true -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endfor -%}
          </ul>
        {%- else -%}
          <div class="recently-viewed__warnings flex flex-column flex-1 justify-center center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 455 455"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              class="icon icon-no-product"
              aria-hidden="true"
              focusable="false"
              role="presentation"
              xml:space="preserve"
            >
              <path d="M360.967,130.599c-4.06-0.818-8.018,1.8-8.841,5.86c-0.823,4.06,1.801,8.018,5.86,8.841
              c1.147,0.232,2.013,1.286,2.013,2.45v160c0,1.355-1.145,2.5-2.5,2.5H179.676c-4.142,0-7.5,3.357-7.5,7.5s3.358,7.5,7.5,7.5H357.5
              c9.649,0,17.5-7.851,17.5-17.5v-160C375,139.46,369.099,132.247,360.967,130.599z"></path>
              <path d="M274.824,130.25H97.5c-9.649,0-17.5,7.851-17.5,17.5v160c0,8.063,5.48,15.046,13.326,16.982
              c0.604,0.149,1.208,0.221,1.803,0.221c3.369,0,6.432-2.287,7.276-5.705c0.992-4.021-1.463-8.086-5.484-9.078
              c-0.955-0.235-1.92-1.143-1.92-2.42v-160c0-1.355,1.145-2.5,2.5-2.5h177.324c4.142,0,7.5-3.357,7.5-7.5
              S278.966,130.25,274.824,130.25z"></path>
              <path d="M235.363,170.798c-2.655-0.363-5.3-0.548-7.863-0.548c-31.706,0-57.5,25.794-57.5,57.5c0,2.563,0.185,5.209,0.548,7.863
              c0.515,3.759,3.731,6.483,7.421,6.483c0.339,0,0.682-0.023,1.027-0.07c4.104-0.562,6.975-4.345,6.413-8.448
              c-0.271-1.982-0.409-3.943-0.409-5.828c0-23.435,19.065-42.5,42.5-42.5c1.884,0,3.845,0.138,5.828,0.409
              c4.108,0.564,7.886-2.309,8.448-6.413C242.338,175.143,239.467,171.359,235.363,170.798z"></path>
              <path d="M219.127,284.636c2.789,0.407,5.605,0.614,8.373,0.614c31.706,0,57.5-25.794,57.5-57.5c0-2.77-0.207-5.587-0.613-8.373
              c-0.599-4.099-4.408-6.934-8.505-6.337c-4.099,0.599-6.936,4.406-6.337,8.505c0.303,2.071,0.456,4.158,0.456,6.205
              c0,23.435-19.065,42.5-42.5,42.5c-2.044,0-4.132-0.153-6.205-0.456c-4.099-0.6-7.907,2.238-8.505,6.337
              S215.028,284.037,219.127,284.636z"></path>
              <path d="M318.5,203.25c9.098,0,16.5-7.402,16.5-16.5c0-8.318-6.227-15.355-14.484-16.37c-2.293-0.277-4.585,0.509-6.218,2.142
              l-10.027,10.027c-1.633,1.632-2.422,3.926-2.141,6.217C303.145,197.023,310.183,203.25,318.5,203.25z"></path>
              <path d="M117.5,114.75h30c4.142,0,7.5-3.357,7.5-7.5s-3.358-7.5-7.5-7.5h-30c-4.142,0-7.5,3.357-7.5,7.5
              S113.358,114.75,117.5,114.75z"></path>
              <path d="M388.367,66.633C345.397,23.664,288.268,0,227.5,0S109.603,23.664,66.633,66.633C23.664,109.603,0,166.732,0,227.5
              s23.664,117.897,66.633,160.867C109.603,431.336,166.732,455,227.5,455s117.897-23.664,160.867-66.633
              C431.336,345.397,455,288.268,455,227.5S431.336,109.603,388.367,66.633z M15,227.5C15,110.327,110.327,15,227.5,15
              c55.894,0,106.807,21.703,144.783,57.11L72.11,372.283C36.703,334.307,15,283.395,15,227.5z M227.5,440
              c-55.894,0-106.807-21.703-144.783-57.11L382.89,82.717C418.297,120.693,440,171.606,440,227.5C440,344.673,344.673,440,227.5,440z
              "></path>
            </svg>
            <span class="text">{{ 'content.sorry_no_products' | t }}</span>
          </div>
        {%- endif -%}
      </recently-viewed-products>
    </div>
  </div>
</side-drawer>

{% schema %}
  {
    "name": "t:names.recently_viewed_products",
    "tag": null,
    "settings": [
      {
        "type": "number",
        "id": "products_to_show",
        "label": "t:settings.products_to_show",
        "default": 4
      },
      {
        "type": "header",
        "content": "t:content.recently_viewed_products"
      },
      {
        "type": "checkbox",
        "id": "inherit_color_scheme",
        "label": "t:settings.inherit_color_scheme",
        "default": true
      },
      {
        "type": "color",
        "id": "scheme_background",
        "label": "t:settings.background",
        "default": "#FFFFFF",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color_background",
        "id": "scheme_background_gradient",
        "label": "t:settings.background_gradient",
        "info": "t:info.background_gradient_info",
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_foreground_heading",
        "label": "t:settings.headings",
        "default": "#000000",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_foreground",
        "label": "t:settings.text",
        "default": "#000000",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_primary",
        "label": "t:settings.primary_color",
        "default": "#000F9F",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_primary_hover",
        "label": "t:settings.primary_hover_color",
        "default": "#000000",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_border",
        "label": "t:settings.borders",
        "default": "#E6E6E6",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      },
      {
        "type": "color",
        "id": "scheme_shadow",
        "label": "t:settings.shadow_color",
        "default": "#000000",
        "alpha": true,
        "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
      }
    ],
    "presets": [
      {
        "name": "t:names.recently_viewed_products"
      }
    ]
  }
  {% endschema %}