{% liquid
  assign product_resource = closest.product
  if request.visual_preview_mode and product_resource == blank
    assign product_resource = collections.all.products.first
  endif

  assign require_item = block.settings.require_item

  if block.settings.show_customization_option and require_item != blank
    if product_resource.has_only_default_variant
      assign variant_type = 1
    else
      for option in product_resource.options_with_values
          assign forloop_index = forloop.index0 | plus: 1
      endfor
      assign variant_type = product_resource.options_with_values.size | plus: 1
    endif
  else
    assign variant_type = product_resource.options_with_values.size
  endif

  assign steps_color = block.settings.steps_color
  assign steps_color_added = block.settings.steps_color_added
  assign detail_variant_bg = block.settings.detail_variant_bg
-%}

<div class="steps{% unless variant_type > 1 %} hidden{% endunless %}"
  steps="{{ variant_type }}"
  style="
  --steps-color: {{ steps_color.red }},{{ steps_color.green }},{{ steps_color.blue }};
  --steps-color-added: {{ steps_color_added.red }},{{ steps_color_added.green }},{{ steps_color_added.blue }};"
>
  {%- for option in product_resource.options_with_values -%}
    <div class="steps__step" data-step="{{ forloop.index0 }}">
      <div class="steps__step-number"><span class="checkmark"></span></div>
      <div class="steps__step-name"><legend class="form__label">{{ option.name }}</legend></div>
    </div>
  {%- endfor -%}
  {%- if block.settings.show_customization_option and require_item != blank -%}
    <div class="steps__step" data-step="{{ forloop_index }}">
      <div class="steps__step-number"><span class="checkmark"></span></div>
      <div class="steps__step-name"><legend class="form__label">{{ require_item }}</legend></div>
    </div>
  {%- endif -%}
</div>

{% render 'sbs-variant-picker', 
  product_resource: product_resource, 
  show_customization_option: block.settings.show_customization_option, 
  require_item: require_item,
  detail_variant_bg: detail_variant_bg,
  forloop_index: forloop_index
%}

{% schema %}
{
  "name": "t:names.product_variant_picker",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "t:content.resource_reference_product_variant_picker"
    },
    {
      "type": "paragraph",
      "content": "t:content.edit_variants_in_theme_settings"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "t:settings.alignment",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "left"
    },
    {
      "type": "checkbox",
      "id": "show_customization_option",
      "label": "t:settings.show_customization_option",
      "default": true
    },
    {
      "type": "text",
      "id": "require_item",
      "label": "t:settings.option_name",
      "default": "Require",
      "visible_if": "{{ block.settings.show_customization_option == true }}"
    },
    {
      "type": "header",
      "content": "t:settings.color"
    },
    {
      "type": "color",
      "id": "steps_color",
      "label": "t:settings.text_icon",
      "default": "#9CA3AF"
    },
    {
      "type": "color",
      "id": "steps_color_added",
      "label": "t:settings.text_icon_active",
      "default": "#2252BC"
    },
    {
      "type" : "color",
      "id" : "detail_variant_bg",
      "label": "t:settings.variant_background_color",
      "default" : "#F6F6F6"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "t:names.product_variant_picker",
      "category": "t:categories.product"
    }
  ]
}
{% endschema %}
